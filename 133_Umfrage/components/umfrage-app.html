<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/font-roboto/roboto.html">
<link rel="import" href="../bower_components/core-drawer-panel/core-drawer-panel.html">
<link rel="import" href="../bower_components/core-header-panel/core-header-panel.html">
<link rel="import" href="../bower_components/core-toolbar/core-toolbar.html">
<link rel="import" href="../bower_components/core-icons/core-icons.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../bower_components/core-localstorage/core-localstorage.html">
<link rel="import" href="../bower_components/core-item/core-item.html">
<link rel="import" href="../bower_components/paper-toggle-button/paper-toggle-button.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-slider/paper-slider.html">
<link rel="import" href="../bower_components/paper-toast/paper-toast.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-shadow/paper-shadow.html">
<link rel="import" href="../bower_components/core-ajax/core-ajax.html">

<link rel="import" href="umfrage-item.html">



<polymer-element name="umfrage-app">
  <template>
  <link rel="stylesheet" href="../styles.css">
  <core-drawer-panel responsiveWidth="600px" id="drawerPanel">
    <core-header-panel drawer>
        <core-toolbar>Menu</core-toolbar>

    </core-header-panel>



    <core-header-panel main>
      <core-toolbar>
        <paper-icon-button icon="menu" on-click="{{toggleDrawer}}"></paper-icon-button>
        <span flex>Umfrage</span>

        <paper-fab hidden?="{{!valid}}" icon="icons:send" on-click="{{sendAnswers}}"></paper-fab>
      </core-toolbar>
      <div class="content">
        <template repeat="{{question, questionIndex in questions}}">
          <umfrage-item question="{{question}}" answer="{{answers[questionIndex]}}"></umfrage-item>
        </template>
        <core-localstorage name="answers" value="{{answers}}"></core-localstorage>
        <core-ajax id="sendAnswers" url="../saveAnswers.php" method="POST"></core-ajax>
        <core-ajax auto url="../questions.json" handleAs="json" on-core-response="{{answersChanged}}" response="{{questions}}"></core-ajax>
      </div>
    </core-header-panel>
  </core-drawer-panel>
  </template>

  <script>
    Polymer('umfrage-app', {
      answers: [],
      valid: false,
      answersChanged: function() {
        var size = this.answers.filter(function(value) { return value !== undefined }).length;
        if (this.questions && size == this.questions.length) {
          this.valid = true;
        }
      },
      sendAnswers: function() {
        this.$.sendAnswers.body = this.answers;
        this.$.sendAnswers.go();
      }
    });
  </script>
</polymer-element>